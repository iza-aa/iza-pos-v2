# ğŸ¯ ROLE & ACCESS MATRIX - FOODIES POS

## ğŸ“Š ROLE COMPARISON TABLE

| Feature / Module | Owner | Manager | Staff (Barista/Kitchen/Waiter/Cashier) | Customer |
|-----------------|-------|---------|---------------|----------|
| **AUTHENTICATION** |
| Login Method | Email + Password | Email + Password | Staff Code + Login Code | Phone Number |
| Password Type | Permanent (hashed) | Permanent (hashed) | Temporary (24h expire) | No password |
| Can Reset Password | âœ… Yes | âœ… Yes | âŒ No (request to Manager) | N/A |
| **DASHBOARD** |
| View Analytics | âœ… Full Access | âœ… Operational Metrics | âœ… Personal Performance | âŒ No |
| Sales Reports | âœ… All Reports | âœ… Daily/Weekly Reports | âŒ No | âŒ No |
| Financial Data | âœ… Full Access | âœ… Limited | âŒ No | âŒ No |
| **MENU MANAGEMENT** |
| View Menu | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes |
| Add/Edit Menu | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| Delete Menu | âœ… Yes | âœ… Yes (logged) | âŒ No | âŒ No |
| Manage Categories | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| **VARIANTS** |
| View Variants | âœ… Yes | âœ… Yes | âœ… Yes (POS only) | âœ… Yes |
| Manage Variant Groups | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| Add/Edit Options | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| **INVENTORY** |
| View Inventory | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| Add Raw Materials | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| Adjust Stock | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| Manage Recipes | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| View Usage History | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| **ORDERS** |
| Create Order (POS) | âœ… Yes | âœ… Yes | âœ… Yes | âŒ No |
| View All Orders | âœ… Yes | âœ… Yes | âœ… Own Orders Only | âœ… Own Orders Only |
| Mark as Served | âœ… Yes | âœ… Yes | âœ… Yes | âŒ No |
| Cancel Order | âœ… Yes | âœ… Yes | âŒ No (need approval) | âŒ No |
| Void Transaction | âœ… Yes | âœ… Yes (logged) | âŒ No | âŒ No |
| **STAFF MANAGEMENT** |
| View Staff List | âœ… Yes | âŒ No | âŒ No | âŒ No |
| Add/Edit Staff | âœ… Yes | âŒ No | âŒ No | âŒ No |
| Delete Staff | âœ… Yes | âŒ No | âŒ No | âŒ No |
| Generate Login Code | âœ… Yes | âŒ No | âŒ No | âŒ No |
| View Staff Performance | âœ… Yes | âŒ No | âœ… Own Performance | âŒ No |
| **SHIFT & ATTENDANCE** |
| Create Shift Schedule | âœ… Yes | âŒ No | âŒ No | âŒ No |
| View Shift Schedule | âœ… All Staff | âŒ No | âœ… Own Schedule | âŒ No |
| Check In/Out | âœ… Yes | âœ… Yes | âœ… Yes | âŒ No |
| Generate Presence Code | âœ… Yes | âŒ No | âŒ No | âŒ No |
| **ACTIVITY LOGS** |
| View Activity Logs | âœ… Yes | âŒ No | âŒ No | âŒ No |
| Export Logs | âœ… Yes | âŒ No | âŒ No | âŒ No |
| Filter by User/Action | âœ… Yes | âŒ No | âŒ No | âŒ No |
| **CUSTOMER FEATURES** |
| Browse Menu | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes |
| Order History | âŒ No | âŒ No | âŒ No | âœ… Yes |
| Loyalty Points | âŒ No | âŒ No | âŒ No | âœ… Yes |
| Profile Management | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes |
| **SETTINGS** |
| System Settings | âœ… Yes | âŒ No | âŒ No | âŒ No |
| Business Info | âœ… Yes | âŒ No | âŒ No | âŒ No |
| Tax Configuration | âœ… Yes | âŒ No | âŒ No | âŒ No |

---

## ğŸ” AUTHENTICATION DETAILS

### 1ï¸âƒ£ OWNER (Super Admin)
```
Table: staff
Conditions:
- role = 'owner'
- status = 'active'
- email UNIQUE
- password_hash (bcrypt)

Login Flow:
POST /api/owner/login
{
  email: "owner@foodies.com",
  password: "owner123"
}

Response:
{
  success: true,
  user_id: "uuid",
  user_name: "John Owner",
  user_role: "owner"
}

localStorage:
- user_id
- user_name
- user_role = "owner"

Redirect: /owner/dashboard
```

---

### 2ï¸âƒ£ MANAGER
```
Table: staff
Conditions:
- role = 'manager'
- status = 'active'
- email UNIQUE
- password_hash (bcrypt)

Login Flow:
POST /api/manager/login
{
  email: "manager@foodies.com",
  password: "manager123"
}

Response:
{
  success: true,
  user_id: "uuid",
  user_name: "Jane Manager",
  user_role: "manager"
}

localStorage:
- user_id
- user_name
- user_role = "manager"

Redirect: /manager/menu
```

---

### 3ï¸âƒ£ STAFF (Barista, Kitchen, Waiter, Cashier)
```
Table: staff
Conditions:
- role = 'staff'
- staff_type IN ('barista', 'kitchen', 'waiter', 'cashier')
- status = 'active'
- staff_code UNIQUE
- login_code (8 digit, temporary)
- login_code_expires_at > NOW()

Login Flow:
POST /api/staff/login
{
  staff_code: "STF001",
  login_code: "12345678"
}

Response:
{
  success: true,
  user_id: "uuid",
  user_name: "Alice Barista",
  user_role: "staff",
  staff_type: "barista",
  staff_code: "STF001"
}

localStorage:
- user_id
- user_name
- user_role = "staff"
- staff_type = "barista" | "kitchen" | "waiter" | "cashier"
- staff_code

Redirect: /staff/dashboard
```

**Login Code Management:**
- Generated by Owner via Staff Manager
- Valid for 24 hours
- No permanent password (security reason)
- If expired, staff must request new code

---

### 4ï¸âƒ£ CUSTOMER
```
Table: customers
Conditions:
- phone UNIQUE
- status = 'active'

Login Flow:
POST /api/customer/login
{
  phone: "08123456789",
  name: "John Doe" (required if new)
}

Response (Existing Customer):
{
  success: true,
  customer_id: "uuid",
  customer_name: "John Doe",
  customer_phone: "08123456789",
  is_new: false
}

Response (New Customer):
{
  success: true,
  customer_id: "uuid",
  customer_name: "John Doe",
  customer_phone: "08123456789",
  is_new: true
}

localStorage:
- customer_id
- customer_name
- customer_phone

Redirect: /customer/menu
```

**Customer Features:**
- Auto-register on first login
- No password required (phone-based)
- Can track order history
- Loyalty points system
- For production: Add OTP verification

---

## ğŸ›£ï¸ ROUTE STRUCTURE

```
/
â”œâ”€â”€ owner/
â”‚   â”œâ”€â”€ login/              â†’ Public
â”‚   â”œâ”€â”€ dashboard/          â†’ Protected (owner only)
â”‚   â”œâ”€â”€ staff-manager/      â†’ Protected (owner only)
â”‚   â”œâ”€â”€ activitylog/        â†’ Protected (owner only)
â”‚   â””â”€â”€ financialreport/    â†’ Protected (owner only)
â”‚
â”œâ”€â”€ manager/
â”‚   â”œâ”€â”€ login/              â†’ Public
â”‚   â”œâ”€â”€ menu/               â†’ Protected (manager only)
â”‚   â”œâ”€â”€ variants/           â†’ Protected (manager only)
â”‚   â”œâ”€â”€ inventory/          â†’ Protected (manager only)
â”‚   â””â”€â”€ order/              â†’ Protected (manager only)
â”‚
â”œâ”€â”€ staff/
â”‚   â”œâ”€â”€ login/              â†’ Public
â”‚   â”œâ”€â”€ dashboard/          â†’ Protected (staff/cashier only)
â”‚   â”œâ”€â”€ pos/                â†’ Protected (staff/cashier only)
â”‚   â”œâ”€â”€ order/              â†’ Protected (staff/cashier only)
â”‚   â””â”€â”€ shift/              â†’ Protected (staff/cashier only)
â”‚
â””â”€â”€ customer/
    â”œâ”€â”€ login/              â†’ Public
    â”œâ”€â”€ menu/               â†’ Protected (customer only)
    â”œâ”€â”€ order-history/      â†’ Protected (customer only)
    â””â”€â”€ profile/            â†’ Protected (customer only)
```

---

## ğŸ”„ PERMISSION HIERARCHY

```
Owner (Level 4 - Full Access)
â””â”€â”€ All system features
    â”œâ”€â”€ View/Edit/Delete everything
    â”œâ”€â”€ Manage staff & permissions
    â”œâ”€â”€ Access financial data
    â””â”€â”€ View activity logs

Manager (Level 3 - Operational)
â””â”€â”€ Menu, Inventory, Orders
    â”œâ”€â”€ CRUD menu items
    â”œâ”€â”€ Manage variants
    â”œâ”€â”€ Track inventory
    â”œâ”€â”€ Monitor orders
    â””â”€â”€ Cannot manage staff

Staff (Level 2 - Daily Operations)
â””â”€â”€ POS, Orders, Attendance (based on staff_type)
    â”œâ”€â”€ Barista: Beverage orders, coffee machine
    â”œâ”€â”€ Kitchen: Food orders, cooking queue
    â”œâ”€â”€ Waiter: Take orders, serve food, manage tables
    â”œâ”€â”€ Cashier: Full POS, payment processing
    â”œâ”€â”€ Mark items as served
    â”œâ”€â”€ View own performance
    â”œâ”€â”€ Check in/out attendance
    â””â”€â”€ Cannot edit menu/inventory

Customer (Level 1 - Self Service)
â””â”€â”€ Browse & Order
    â”œâ”€â”€ View menu
    â”œâ”€â”€ Place orders
    â”œâ”€â”€ Track order history
    â”œâ”€â”€ View loyalty points
    â””â”€â”€ Update profile
```

---

## ğŸš€ IMPLEMENTATION CHECKLIST

### Phase 1: Database Setup âœ…
- [x] Create database schema
- [x] Add indexes for performance
- [x] Insert seed data for testing
- [x] Setup Supabase connection

### Phase 2: Authentication âœ…
- [x] Owner login API & page
- [x] Manager login API & page
- [x] Staff login API & page
- [x] Customer login API & page
- [x] localStorage management
- [x] Redirect logic

### Phase 3: Authorization (Next)
- [ ] Middleware untuk protected routes
- [ ] Role-based access control
- [ ] Session management
- [ ] Logout functionality
- [ ] Token refresh mechanism

### Phase 4: Security (Production)
- [ ] Password hashing (bcrypt)
- [ ] JWT for sessions
- [ ] Rate limiting
- [ ] OTP verification (customer)
- [ ] HTTPS enforcement
- [ ] XSS & CSRF protection

---

## ğŸ“ NOTES

1. **Development vs Production**:
   - Development: Plain text passwords, no OTP
   - Production: Bcrypt hashing, JWT, OTP verification

2. **Staff Login Code**:
   - Temporary untuk keamanan
   - Owner generate via Staff Manager page
   - Auto-expire dalam 24 jam
   - Staff tidak bisa reset sendiri

3. **Customer Phone Login**:
   - Untuk development: langsung login dengan phone
   - Untuk production: tambahkan OTP via SMS/WhatsApp
   - Auto-register jika nomor baru

4. **Role Separation**:
   - Owner & Manager = table `staff` dengan role berbeda
   - Staff & Cashier = table `staff` dengan login_code
   - Customer = table `customers` terpisah

5. **Security Best Practices**:
   - Never store plain text passwords in production
   - Use environment variables for secrets
   - Implement rate limiting on login endpoints
   - Add CAPTCHA for repeated failed attempts
   - Log all authentication attempts
